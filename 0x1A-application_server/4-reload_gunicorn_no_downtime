#!/usr/bin/env bash
# Find the Gunicorn master process IDs using pgrep

PGREP_OUTPUT=$(pgrep -f 'gunicorn.*')

if [ -z "$PGREP_OUTPUT" ]; then
    echo "No Gunicorn master process found."
    exit 1
fi
echo "Reloading Gunicorn gracefully..."

for PID in $PGREP_OUTPUT; do
    if ps -p $PID > /dev/null; then
        echo "Sending HUP signal to PID $PID"
        kill -HUP $PID
    else
        echo "PID $PID no longer exists."
    fi
done

echo "Reload complete."
